{% extends "baselogin.html" %}
{% block content %}
{% load static %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">

<style>
  /* body {
  background: #c5d8e6;
  font-family: helvetica, arial !important;
  text-transform: uppercase;
  box-sizing: border-box;
} */
h1 {
  color: #000000;
  font-weight: 200;
  font-size: 2.1em;
  margin: 0px !important;
}
h2 {
  color: #1d1e1f;
  /* opacity: 0.5; */
  font-weight: 100;
  font-size: 10px!important;
  margin: 0px !important;
  margin-bottom: 2px;
  color: rgb(165, 150, 150);
  font-family: helvetica, arial !important;;
}
h3 {
  color: #2c2f30;
  /* opacity: 0.8; */
  font-weight: 500;
  font-size: 12px;
  margin: 0px !important;
}

</style>
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="previewnav" data-bs-toggle="tab" data-bs-target="#previewtab" type="button" role="tab" aria-controls="previewtab" aria-selected="true">{{login_preview_tab}}</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="logintabnav" data-bs-toggle="tab" data-bs-target="#logintab" type="button" role="tab" aria-controls="logintab" aria-selected="false">{{playerdashboard_edit_tab}}</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="passnav" data-bs-toggle="tab" data-bs-target="#passtab" type="button" role="tab" aria-controls="passtab" aria-selected="false">{{login_download_tab}}</button>
  </li>
</ul>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="previewtab" role="tabpanel" aria-labelledby="previewnav">
      <div class="d-flex justify-content-center" >
        <div class="spinner-border"  role="status" >
          <span class="sr-only">..</span>
        </div>
      </div>
      <div  name="form1" id="form1" class="col-lg-12 col-md-6 col-sm-12 glass-morphism-container1"> 
        <h4 class="form-heading">{{heading_player_preview}}</h4>
        {% csrf_token %}
      
        <div class="row" id="thisid">
          <div class="text-center col-lg-12 col-md-12 col-sm-12 mt-1">
            <div class="form-group mb-0">
              <h5 class="text-center" id="information_text">
                
              </h5>
            </div>
          </div>
          <div class="col-lg-12 col-md-6 col-sm-12  ">
            <div class="card-body px-1-6  d-flex justify-content-center align-items-center position-relative" style="flex-direction: row; ">
              
              
              <label class="text-secondary  small font-weight-600 " style="color: wheat !important;">Payment Status </label>
              
              <label class="px-1">  :  </label>
              <label class="card-btn "  id="status"></label>
              
              
            </div>

         </div>


  
          {% for field in formikf %} 
          {% if field.type == "label" or field.type == "cstate"  or field.type == "dob" or field.type == "cposition" %}
      
      
        <div class="col-lg-12 col-md-6 col-sm-12  ">
                          <div class="card-body px-1-6  d-flex justify-content-center align-items-center position-relative" style="flex-direction: row; ">
                            
                            
                            <label class="text-secondary  small font-weight-600 " style="color: wheat !important;">{{field.label}}</label>
                            
                            <label class="px-1">  :  </label>
                            <label class="card-btn "  id="{{field.columnid}}"></label>
                            
                            
                        </div>
      
          </div>
          {% elif field.type == "ccity" %}
      
          <div class="col-lg-12 col-md-6 col-sm-12 " id="ccity">
            <div class="card-body px-1-6  d-flex justify-content-center align-items-center position-relative" style="flex-direction: row; ">
              
              
              <label class="text-secondary  small font-weight-600 " style="color: wheat !important;">{{field.label}}</label>
              
              <label class="px-1">  :  </label>
              <label class="card-btn "  id="{{field.columnid}}"></label>
              
              
          </div>
      
      </div>
          {% elif field.type == "uploadpic" %}
          <div id="pic_file_set"class="col-lg-12 col-md-6 col-sm-12 mt-1">
            
            <div class="form-group px-1-6  d-flex justify-content-center align-items-center position-relative" style="flex-direction: column; ">
              <label>{{uploaded_pic_preview_label}}</label>
              <img
                
               
                id="pic_file"
                name="pic_file"
                width="260px"
                height="200px"
                >
              </img>
            </div>
          </div>

          {% endif %} 
          {% endfor %}
      
      
      
      
      
      
      
      
      
          <div class="d-flex justify-content-center" >
            <div class="spinner-border"  role="status" >
              <span class="sr-only">..</span>
            </div>
          </div>
      
      

      
      
        </div>
      </div> 


    </div>



























    <div class="tab-pane fade" id="passtab" role="tabpanel" aria-labelledby="passnav">

<!-- Player Pass -->
<div class="body-div" style="display: flex;flex-direction:column;align-items: center;">
  <div class="cards_wrapper" style="background-color:#c5d8e6 ;"  id="playerpass">
    <div class="card">
      <div class="card_heading">
        <h3 style="font-weight: 500; ">{{ikf_season_number_label}} <span id="header_city" hidden="hidden"></span> {{usconnect_pass}}</h3>
      </div>
      <div class="card_trip">
        <img class="pic_file" alt="PROFILE PIC"
        style="    width: 150px;
        height: 150px;
        border-radius: 50%;
        border-color: black;
        padding: 0px;">
      </div>
      <div class="new_palyer_div" style=" margin-bottom: 1em;">
        <div class="name" id="name">Player Name</div>
        <div class="dob" id="dob">yyyy/mm/dd</div>
      </div>
      <div class="card_divider">
        <div class="divider_left divider_hole">
        </div>
        <div class="divider">
        </div>
        <div class="divider_right divider_hole">
        </div>
      </div>
      <!-- <div class="tournament_details" style="margin-bottom: 0px;">
        <div class="details_state">
          <h3 id="tournament_state_id">STATE</h3>
        </div>
        <div class="details_city">
          <h3 id="tournament_city_id">CITY</h3>
        </div>
        <div class="details_category">
          <h3>CAT <span id="category_age">AGE</span><span style="font-weight: 600;" id="gender">GEN</span></h3>
        </div>
      </div> -->
       <!-- AADHAR details -->
       {% comment %} <div class="aadhar_details">
        <h3><span id="document_id_selected_id">DOCUMENT TYPE</span> <b>:</b></h3><h3 id="document_id_number">DOCUMENT ID</h3>
      </div> {% endcomment %}
      <div class="aadhar_details" style="text-align: start;">
        <h3>{{venue_area | safe}} </h3>
      </div>
      <div class="aadhar_details" style="text-align: start;">
        <h3>{{venue_date | safe}} </h3>
      </div>
      <div class="card_header" >
        <img class="player_id_barcode" alt="BARCODE" style="width:fit-content;height:fit-content; margin-top: 0px;"></img>
       </div>
       <img class="logo" src="{% static 'img/ikflogo.png' %} " style="height: 60px;width: 120px;justify-self: center;margin-bottom: 0.7em;"></img>
      <div style="font-style: normal;font-size:small;text-align: center;color: black;
      font-family: 'Alex Brush', cursive;
      color: #187ec0;
      /* font-weight: 600; */
      font-size: 22px;
      background-color: white;
      border-bottom-left-radius: 20px;
      letter-spacing:1px;
      border-bottom-right-radius: 20px; text-transform: none !important;">{{aap_khelo_mauka_hum_denge}}</div>
    </div>
  </div>
   
  <!-- PRINT BUTTON -->
  <div class="text-center col-lg-12 col-md-12 col-sm-12 mt-3">
    <div class="form-group mb-0">
        <button class="btn login-btn" id="download" > Download </button>
    </div>
  </div>
</div>


<script src="{% static 'js/html2canvas.js' %}" type="text/javascript"></script>
    </div>

    <div class="tab-pane fade" id="logintab" role="presentation" aria-labelledby="logintabnav">
      <div class="d-flex justify-content-center" >
        <div class="spinner-border"  role="status" >
          <span class="sr-only">..</span>
        </div>
      </div>
      <div  name="form123" id="form123" class="col-lg-12 col-md-6 col-sm-12 glass-morphism-container1"> 
      {% csrf_token %}
      <form method="post"  name="form1234" id="form1234" >
        <h4 class="form-heading">{{heading_login_player_name__form}}</h4>
        {% csrf_token %}
    <input type="hidden" name="_token" value="b1nCcqafDVGwwKwH5DLWqeD06kDWSQBXGrPwAco3">
        <div class="row">

            <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                <div class="form-group">
                    <label class="text-left">{{first_name}}<span class="mandatory">* </span></label>
                    <input class="form-control" type="text" name="first_name"  id="first_name" required minlength="3" readonly>
                </div>
            </div>

            <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                <div class="form-group">
                    <label class="text-left">{{last_name}}<span class="mandatory">* </span></label>
                    <input class="form-control" type="text" name="last_name" id="last_name" required minlength="3" readonly>
                </div>
            </div>






            <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                <div class="form-group">
                    <label class="text-left">{{primary_position}} <span class="mandatory">*
                        </span></label>
                    <select class="form-control" name="primary_position" id="primary_position" required="" data-fillr-id="1552374762" data-fillr="bound" autocomplete="off">
                        <option value="">{{dropdown_select_position}}</option>

                    </select>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                <div class="form-group">
                    <label class="text-left">{{secondary_position}}<span class="mandatory">*
                        </span></label>
                        <select class="form-control" name="secondary_position" id="secondary_position" required="" data-fillr-id="1552374762" data-fillr="bound" autocomplete="off">
                            <option value="">{{dropdown_select_position}}</option>

                        </select>
                </div>
            </div>




        </div>
    </form>

    <form
    action=""
    name="upload-form"
    id="upload-form"
    method="POST"
    enctype="multipart/form-data"
    
  >
    
    {% csrf_token %}
  
    <div id="alert-box"></div>
    <div
      id="image-box"
      class="d-flex justify-content-center align-items-center position-relative"
      style="flex-direction: row"
    ></div>
    <br />
  
    <label>{{upload_your_pic}}</label>
  
    {{uploadform.as_p}}
  
    <br />
    <div id="progress-box" class="not-visible">Progress</div>
    <div id="cancel-box" class="not-visible">
      <button id="cancel-btn" class="btn btn-danger">cancel</button>
    </div>
    <div class="row">

        <!-- <div class="col-lg-12 col-md-12 col-sm-12 mt-3 border p-3 rounded bg-white">
            <div class="custom-control custom-checkbox checkbox-lg" style="color:black">
                <input type="checkbox" class="custom-control-input" id="checkbox-2" required>
                <label class="custom-control-label" for="checkbox-2"> {{i_authorize|safe}}
                  
                    </span></label>
            </div>
        </div> -->

        <div class="text-center col-lg-12 col-md-12 col-sm-12 mt-3">
            <div class="form-group mb-0">
 
                <button class="btn login-btn" onclick="edit_player(this)" type="submit"> {{playerdashboard_edit_button}} </button>
            </div>
        </div>
    </div>
  </form>
     </div>
     </div>
     </div>



  <script>
    var GLOBAL_FILENAME=""

    var GROUP_DATA=""
    var AMOUNT=""
    var IKFUNIQUEID=""
    var ID=""
    var PLAYERUPLOADID=""
    var EMAIL=""
    var MOBILE=""
    var CUSTOMERNAME=""
    var AMOUNT=""
    var ORDER_ID=""
    var amount_dict={}
      function checkempty(data) {
        if (data == null || data == "" || data == undefined) {
          return "NA";
        } else {
          return data;
        }
      }
    
      function converter(data,type, documentid){
        

        
        $.ajax({
          type: "POST",
          url: "{% url 'converter' %}",
          data:{id:data,type:type,csrfmiddlewaretoken:'{{ csrf_token }}'},
    
          success: function(result){
            if(result){

              var converterdata=JSON.parse(result)
              if(converterdata[0]){
             
                document.getElementById(documentid).innerHTML=converterdata[0]['label']
    
              }
    
              
    
              
            }
            
    
    
          }
        }
        )  
    
      }
    

    
    window.onload = function(e) {

    preview()



      
      }

function preview(){
  $('.spinner-border').hide();

      
  var allElements =document.getElementById("thisid").getElementsByTagName("*");
  var allIds = [];
  for (var i = 0, n = allElements.length; i < n; ++i) {
    var el = allElements[i];
    if (el.id) { allIds.push(el.id); }
  } 
  
  const imageBox=document.getElementById("pic_file");
  const fileBox=document.getElementById("document_id_file")
  $.ajax({
    type: "POST",
    url: "{% url 'playerdatalogin' %}",
    data:{ikfuniqueid:sessionStorage.getItem('ikfloginuniqueid') ,csrfmiddlewaretoken:'{{ csrf_token }}'},

    success: function(inputdata){


            if(inputdata){

              IKFUNIQUEID=inputdata['ikfuniqueid']
              PLAYERUPLOADID=inputdata['playeruploadid']
              ID=inputdata['id']
              EMAIL=inputdata['email']
              MOBILE=inputdata['mobile']
              CUSTOMERNAME=inputdata['first_name']
              amount_dict={
                'tournament_city':inputdata['tournament_city_id'],
                'season':inputdata['season_id'],
                'group':inputdata['group_id'],
                "whoisfilling":inputdata['whoisfilling_id']
        
              }

           allIds.forEach(item => {
           
           if(item=='csrfmiddlewaretoken' || item=='_token' || item=='information_text' || item=='next'||item=='prev'||item=='proceed'||item=='ccity'){}
           else if(item=='tournament_city'||item=='state'||item=='primary_position'||item=='secondary_position'||item=='document_id_selected'){
            var type=item+'_id'
            converter(checkempty(inputdata[type]),type,item)

           }
           else if(item=='pic_file_set'){
           
           
          }
           else if(item=='pic_file'){
            if(inputdata["pic_file"] && inputdata["pic_file"]!=""){

              //imageBox.src=inputdata["pic_file"]
              $.ajax({
                type: "POST",
                url: "{% url 'viewpic' %}",
                data:{playeruploadidfinal:inputdata["playeruploadid"],csrfmiddlewaretoken:'{{ csrf_token }}'},
                success: function(result){
                  if(result){imageBox.src=result;}
                  },
                error:function(error){
                  error="pic file error "+JSON.stringify(error)
                 // alert(JSON.stringify(error),"pic file error")
                }
              })

              
            }else{
             
              document.getElementById("pic_file_set").style.display = "none";
            }
           
           
           }
           else if(item=='document_id_file'){

            if(inputdata["document_id_file"] && inputdata["document_id_file"]!=""){
              fileBox.src=inputdata["document_id_file"]
            }

           }
           else if(item=='status'){
            console.log(inputdata['status'])

            if(inputdata['status']){
              document.getElementById('status').innerHTML=inputdata['status']
            }
            else{
              document.getElementById('status').innerHTML="Payment Not Initiated"
            }
            
            
           }
           else{
            
            document.getElementById(item).innerHTML=checkempty(inputdata[item])}


            

            }); 

      
            $.ajax({
              type: "POST",
              url: "{% url 'amount' %}",
              data:{data:JSON.stringify(amount_dict),csrfmiddlewaretoken:'{{ csrf_token }}'},

              success: function(result){
                if(result){
                  AMOUNT=JSON.parse(result)
                  
                }

                

              },
              error:function(error){

              }
            })


            
            $.ajax({
              type: "POST",
              url: "{% url 'mygroup' %}",
              data:{dob:inputdata['dob'],gender:inputdata['gender'],city:inputdata['tournament_city_id'],include:1,csrfmiddlewaretoken:'{{ csrf_token }}'},

              success: function(result){
                previewdata=JSON.parse(result)
                
                if(previewdata['present']=="1"){
                  GROUP_DATA=previewdata['id'] 
                  if(previewdata['gender']=="Male"){
                    previewdata['gender']="{{ boy_text_in_preview }}"
                  }
                  if(previewdata['gender']=="Female"){
                    previewdata['gender']="{{ girl_text_in_preview }}"
                  }
                  var textoutput="{{you_are_elgible_for}}" + " " + previewdata['group'] + " "+ previewdata["gender"]+" "+"{{category_for_eligibility}}" +" ( " + previewdata['start'] +"-"+ " "+previewdata['end']+" "+ ")"
                  document.getElementById("information_text").innerHTML=textoutput 
                }
                else{
                  GROUP_DATA=""
                  var if_not_eligible_hyperlink_text="{{if_not_eligible_hyperlink_text}}"
                  var if_not_eligible_reason="{{if_not_eligible_reason}}"
                  document.getElementById("information_text").innerHTML= `<a style="color:red;" href="{% url 'coachorplayer' 'en' 'Player' %}">${if_not_eligible_reason} </a>`
                  document.getElementById("next").hidden=true
                 document.getElementById("ccity").hidden=true 
                }
                  

              }})  



       }


            
          },
    error:function(error){
      error="inputdata error"+JSON.stringify(error)
      alert(JSON.stringify(error),"mainfunction")
    }

  })
}
    

    

  function makepass(ikfuniqueid,playeruploadid){

  

  

    $.ajax({
      type: "POST",
      url:"{% url 'playerdata' %}",
      data:{ikfuniqueid:ikfuniqueid, playeruploadid:playeruploadid, csrfmiddlewaretoken:'{{ csrf_token }}' },
      success:function(result){
        try{
        result['name']=result['first_name']+" "+result['last_name'];
        if(result['group_id']=="Under_17_Boys"){result['category_age']="A"}
      else if(result['group_id']=="Under_15_Boys"){result['category_age']="B"}
      else if(result['group_id']=="Under_17_Girls"){result['category_age']="C"}
      else{ result['category_age']="U"+result['group_id'].substring(6,8);}
        result['pic_file']=result['pic_file']==""?(isMale(result['gender'])?"{% static 'img/player/default_profilepic_male.jpg' %}":"{% static 'img/player/default_profilepic_female.jpg' %}"):"../media/images/"+result['pic_file']+'?v=' + result['id'];;

        //result['pic_file']=checkempty(result['pic_file'])?isMale(result['gender'])?"{% static 'img/player/default_profilepic_male.jpg' %}":"{% static 'img/player/default_profilepic_female.jpg' %}":result['pic_file'];
        result['genderofplayer']="(" + result['gender'].substring(0,1)+ ")";
        result['dateofbirth']=result['dob']
        result['player_id_barcode']="../media/barcode/"+result['ikfuniqueid']+'.png';
  
        //for masking
        if(result['document_id_number'] &&  result['document_id_number']!="" && result['document_id_number']!="NA"){

        s="";
        for(i=0;i<result['document_id_number'].length-4;i++)
         s+='X';
        //  temp=mask(result['document_id_number'],s);
        result['document_id_number_pass']=s+result['document_id_number'].substring(result['document_id_number'].length-4);

        }
        else{
          result['document_id_number_pass']="NA"
        }

        
        console.log('success',result);
        var allElementpassID=[];
        $("#playerpass *").each(function(){
          if(this.id){

            allElementpassID.push(this.id);
          }
          
          
        })
        console.log(allElementpassID);
    
          allElementpassID.forEach(function(element){
          if(element=='tournament_city_id'||element=='tournament_state_id'||element=='document_id_selected_id'){
            converterpass(checkempty(result[element]),element,element)
          }
          else if(element=="header_city"){
            console.log("header_city");
          }
          else{
            document.getElementById(element).innerHTML=result[element];
          }
        })
        }
        catch(e){
          alert(JSON.stringify(e))
        }


        document.getElementsByClassName('pic_file')[0].src=result['pic_file'];
        document.getElementsByClassName('player_id_barcode')[0].src=result['player_id_barcode'];
  
       
      },
      error:function(error){'error is here',console.error(error);},
    })
  }

function mask(result,c){
    s=result['document_id_number'];
    var temp="";
    for(i=0;i=s.length-4;i++)
      temp+=c;
    // result['document_id_number']=temp+s.substring(s.length-3,s.length);
    console.log(temp);
}

function converterpass(data,type, documentid){
  if(type=='header_city'){
    data="tournament_city_id";
  }
   $.ajax({
     type: "POST",
     url: "{% url 'converter' %}",
     data:{id:data,type:type,csrfmiddlewaretoken:'{{ csrf_token }}'},

     success: function(result){
       if(result){
         var converterdata=JSON.parse(result)
         console.log(converterdata[0]['label'])
         if(documentid=="tournament_city_id"){
           document.getElementById('tournament_city_id').innerHTML=converterdata[0]['label'];
           console.log(document.getElementById("header_city"),converterdata[0]['label'],'this is header ciity');
           document.getElementById('header_city').innerHTML=converterdata[0]['label'];
         }
         else{
           document.getElementById(documentid).innerHTML=converterdata[0]['label'] 
         }
       }
     }
   }
  )  
 }
// function downloadpass(event,self){

//     alert("downloadpass")
//     // self.addClass("active")
//     self.setAttribute("data-bs-target","#passtab")
 
//     self.setAttribute("aria-controls","passtab")
//     self.setAttribute("aria-selected","true")
//     self.setAttribute("class","active")
    
    



// }

function isMale(data){
  if(data=="Male")
    return true;
  return false;
}

$("#download").on('click', function () {
  html2canvas(document.getElementById("playerpass"),{
    allowTaint: true,
    useCORS: true,
  }).then(function (canvas) {
    var anchorTag = document.createElement("a");
    document.body.appendChild(anchorTag);
    // document.getElementById("previewImg").appendChild(canvas);			
    anchorTag.download = "playerpass.jpg";
    anchorTag.href = canvas.toDataURL();
    anchorTag.target = '_blank';
    anchorTag.click();
  });
});



                



//Edit

function positionchange(self,doc){
    console.log("position change function is called")
    doc.length = 1;
    if(self.value){
        $.ajax({
            type: "POST",
            url: "{% url 'positiondata' %}",
            data:{csrfmiddlewaretoken:'{{ csrf_token }}'},
            success: function(result){
                      var positiondata=JSON.parse(result)
                      for (var x in positiondata) {
                       
                        if(positiondata[x].id==self.value){}
                        else{
                            doc.options[doc.options.length] = new Option(positiondata[x].value, positiondata[x].id);
                        }
                    }
                  }
                })
              }
}

function getFileExtension(filename) {
    // get file extension
    const extension = filename.substring(
      filename.lastIndexOf(".") + 1,
      filename.length
    );
    return extension;
  }


 function Editdata() {

console.log('editdata') 
const formdata=document.getElementById("form1234")             
const primarySel=formdata.querySelector("#primary_position")
const secondarySel=formdata.querySelector("#secondary_position")
const edit_first_name=formdata.querySelector("#first_name")
const edit_last_name=formdata.querySelector("#last_name") 
primarySel.onchange = function(){positionchange(this,secondarySel)}
secondarySel.onclick=function(){
    if(primarySel.value){}
    else{alert("Please Select Primary Position Before selecting Secondary Position")}
    
}

// input data
$.ajax({
    type: "POST",
    url: "{% url 'playerdatalogin' %}",
    data:{ikfuniqueid:sessionStorage.getItem('ikfloginuniqueid') ,csrfmiddlewaretoken:'{{ csrf_token }}'},

    success: function(inputdata){

    var inputdata=inputdata
    if(inputdata['first_name']||inputdata['last_name']||inputdata['last_name']||inputdata['height']||inputdata['weight']||inputdata['state']||inputdata['pincode']|| inputdata['address_line1']||inputdata['address_line2']||inputdata['primary_position']||inputdata['secondary_position']){
        
         edit_first_name.value=checkempty(inputdata["first_name"])
         edit_last_name.value=checkempty(inputdata["last_name"])
}

     
     $.ajax({
        type: "POST",
        url: "{% url 'positiondata' %}",
        data:{csrfmiddlewaretoken:'{{ csrf_token }}'},

        success: function(result){
            var positiondata=JSON.parse(result)
            
            for (var x in positiondata) {
                
                primarySel.options[primarySel.options.length] = new Option(positiondata[x].value, positiondata[x].id);
                secondarySel.options[secondarySel.options.length] = new Option(positiondata[x].value, positiondata[x].id);


            }

            
            if(inputdata["primary_position_id"] && inputdata["secondary_position_id"]){
                   console.log("setting input data")
                    primarySel.value=inputdata["primary_position_id"]
                    secondarySel.value=inputdata["secondary_position_id"]
                    
                    secondarySel.remove(inputdata["primary_position_id"])
                }


          }})

 

// U P L O A D             S C R I P T

const uploadForm = document.getElementById("upload-form");

const input = document.getElementById("id_image");
console.log(input)
input.required = false;

const alertBox = document.getElementById("alert-box");
const imageBox = document.getElementById("image-box");
const progressBox = document.getElementById("progress-box");
const cancelBox = document.getElementById("cancel-box");
const cancelBtn = document.getElementById("cancel-btn");
const csrf = document.getElementsByName("csrfmiddlewaretoken");
console.log(csrf);
console.log(inputdata)



var fwupload=inputdata['playeruploadid']


if (inputdata["pic_file"] && inputdata["pic_file"] != "") {
$.ajax({
type: "POST",
url: "{% url 'viewpic' %}",
data: {
playeruploadidfinal: inputdata["playeruploadid"],
csrfmiddlewaretoken: "{{ csrf_token }}",
},
success: function (result) {
if (result) {
console.log(result);
imageBox.innerHTML = `<img src="${result}" width="260px"></img>`;
}
},
error: function (error) {},
});

input.required = false;
input.style.color = "transparent";
}
input.addEventListener("change", () => {
progressBox.classList.remove("not-visible");
cancelBox.classList.remove("not-visible");
const img_data = input.files[0];
var img_extention = getFileExtension(img_data["name"]);

GLOBAL_FILENAME = fwupload+ "." + img_extention;

const url = URL.createObjectURL(img_data);

const fd = new FormData();
fd.append("unique", fwupload);
fd.append("fname", inputdata["first_name"]);
fd.append("lname", inputdata["last_name"]);
fd.append("mobilenumberupload", inputdata["mobile"]);
fd.append("image", img_data, GLOBAL_FILENAME);

fd.append("csrfmiddlewaretoken", csrf[0].value);

$.ajax({
type: "POST",
url: uploadForm.action,
enctype: "multipart/form-data",
data: fd,
beforeSend: function () {
alertBox.innerHTML = "";
imageBox.innerHTML = "";
},
xhr: function () {
const xhr = new window.XMLHttpRequest();
cancelBtn.classList.remove("not-visible");
xhr.upload.addEventListener("progress", (e) => {
if (e.lengthComputable) {
const percent = (e.loaded / e.total) * 100;
progressBox.innerHTML = `<div class="progress">
                   <div class="progress-bar" role="progressbar" style="width: ${percent}%"  aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100"></div>
                 </div> 
                 <p>${percent.toFixed(1)} %</p>`;
}
});

cancelBtn.addEventListener("click", () => {
xhr.abort();
setTimeout(() => {
uploadForm.reset();
progressBox.innerHTML = "";
alertBox.innerHTML = "";
cancelBtn.classList.add("not-visible");
}, 500);
});
return xhr;
},
success: function (response) {
console.log(response);
imageBox.innerHTML = `<img src="${url}" width="260px"></img>`;
alertBox.innerHTML = `<div class="alert alert-success" role="alert">
          Successfully Uploaded Profile Pic
        </div>`;
cancelBtn.classList.add("not-visible");
},
error: function (error) {
console.log(error);

alertBox.innerHTML = `<div class="alert alert-danger" role="alert">
Something went wrong . Please Choose (.png , .jpg , .jpeg) Files
        </div>`;
setTimeout(() => {
uploadForm.reset();
alertBox.innerHTML = "";
cancelBtn.classList.add("not-visible");
}, 2000);
progressBox.innerHTML = "";
},
cache: false,
contentType: false,
processData: false,
});

console.log(img_data);
});



      
    },
    error:function(error){alert("error in get playerdata api")}
    }
    )


    

 









}




$("#passnav").click(function() {

makepass(IKFUNIQUEID,PLAYERUPLOADID)
   

})
$("#previewnav").click(function() {

  preview()
     

  })

$("#logintabnav").click(function(){
Editdata()
})



function edit_player(node){
  console.log("edit player button called")
  var formData = JSON.parse(JSON.stringify($('#form1234').serializeArray()))
                                var dict={}
                                formData.forEach(function (item) {
                                   dict[item['name']]=item['value']
                                });
                                if(dict['csrfmiddlewaretoken']){delete dict['csrfmiddlewaretoken']}
                                if(dict['_token']){delete dict['_token']}
                                console.log(dict)
                                
                                dict["ikfuniqueid"]=sessionStorage.getItem("ikfloginuniqueid") 
                                if(GLOBAL_FILENAME==""||GLOBAL_FILENAME==null||GLOBAL_FILENAME==undefined){
                                  dict["pic_file"]=null
                                }
                                else{
                                  dict["pic_file"]=GLOBAL_FILENAME 
                                }
                                                        
  $.ajax({
            type: "POST",
            url: "{% url 'editplayer' %}",
            data:{data:JSON.stringify(dict),csrfmiddlewaretoken:'{{ csrf_token }}'},
            success: function(result){
              
              // console.log(result)
              alert("Successfully Edited Data")
                  },
            error: function(error){
                console.log(error)
                 alert("Error While Editing Data. The image size should not exceed 100 kilobytes (KB).")
            }
                })
}
    </script>
{% endblock %}   